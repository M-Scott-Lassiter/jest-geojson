# Contributing Guide

<div align="center">

[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
[![Linting: ESLint](https://img.shields.io/badge/eslint-4B32C3?logo=eslint&logoColor=white)](https://github.com/eslint/eslint)
[![Code format: Prettier](https://img.shields.io/badge/prettier-F7B93E.svg?style=flat-square&logo=prettier&logoColor=black)](https://github.com/prettier/prettier)
[![Style Guide: Airbnb](https://img.shields.io/badge/code_style-airbnb-FF5A5F?logo=airbnb&logoColor=FF5A5F)](https://github.com/airbnb/javascript)
[![jest](https://jestjs.io/img/jest-badge.svg)](https://github.com/facebook/jest)
[![semantic-release: angular](https://img.shields.io/badge/semantic--release-angular-e10079?logo=semantic-release)](https://github.com/semantic-release/semantic-release)

</div>

**Thank you for contributing to `Jest-GeoJSON`!**

Before contributing, please take a moment to read through this document. This guide documents the standards, tooling, and processes that go into the CI/CD pipeline.

<details open="open">
    <summary><b>Table of Contents</b></summary>

<!-- Note: The toc tags mark autogenerated content. Do not manually modify the content here -->

<!-- toc -->

-   [Code of Conduct](#code-of-conduct)
-   [How can I Contribute?](#how-can-i-contribute)
    -   [Submit Issues](#submit-issues)
    -   [Propose New Matchers](#propose-new-matchers)
    -   [Submit a Pull Request](#submit-a-pull-request)
-   [Commits](#commits)
-   [Development](#development)
    -   [Local Installation](#local-installation)
    -   [Project Structure](#project-structure)
    -   [Building](#building)
    -   [Linting and Formatting](#linting-and-formatting)
    -   [Running Tests](#running-tests)
    -   [Documentation](#documentation)
-   [Adding New Matchers](#adding-new-matchers)
    -   [Checklist](#checklist)
    -   [Creating Core Functions](#creating-core-functions)
    -   [Creating New Tests](#creating-new-tests)
    -   [Error Snapshot Testing](#error-snapshot-testing)
    -   [Updating Error Snapshots](#updating-error-snapshots)
    -   [Export Both Core and Matcher Functions](#export-both-core-and-matcher-functions)

<!-- tocstop -->

</details>

## Code of Conduct

Please help keep this project open and inclusive. Refer to the [Code of Conduct](CODE_OF_CONDUCT.md) before your first contribution.

## How can I Contribute?

### Submit Issues

**Bug Reports**: Be as detailed as possible, and fill out all information requested in the [bug report template](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose).

_For security related issues, see the [security policy](https://github.com/M-Scott-Lassiter/jest-geojson/security/policy)._

**Documentation Requests**: Is something unclear in the documentation or the API? Submit a [documentation change request](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose)! Be as detailed as possible. If you have the question, chances are someone else will also who isn't as willing to speak up as you are. If you want to do it yourself, see the [documentation guidelines](#documentation) for instructions.

### Propose New Matchers

These are welcome! Before submitting:

-   Take a moment to make sure your matcher idea fits within the scope and aims of this project. Remember, `Jest-GeoJSON` exports ONLY matchers for Jest to aide test driven developers and their core GeoJSON validation functions. This project **DOES NOT** manipulate or create GeoJSON objects. For that, refer to [Turf.js](https://github.com/Turfjs/turf).
-   Search the issues for [new matchers](https://github.com/M-Scott-Lassiter/jest-geojson/issues?q=label%3A%22new+matcher%22+) to make sure this isn't already in the works.
-   Be as detailed as possible, and fill out a [new matcher request](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose). It is up to you to make your case of why the matcher should get included.

**Please ask** before embarking on any significant undertaking (e.g. implementing a new matcher, major code refactoring), otherwise you risk wasting time on something that might not fit well with the project. Do this by opening an issue for the proposal.

### Submit a Pull Request

Good pull requests are outstanding help. They should remain focused in scope and avoid unrelated commits.

To submit a pull request,

1. Fork and clone the repository
1. Create a branch for your edits
1. Make sure your work follows the [commits](#commits) guidance

## Commits

All commits must follow the common commit guidance in [@m-scott-lassiter/semantic-release-github-npm-config](https://github.com/M-Scott-Lassiter/semantic-release-github-npm-config#commits).

This project uses [Commitizen](http://commitizen.github.io/cz-cli/) and [Husky](https://github.com/typicode/husky) hooks to help enforce good commit practices. Work on matcher functions must use that matcher function name as the scope.

When adding a new matcher, you must update this project's [Commitizen configuration](.cz-config.js) so the matcher shows up in the scope list.

## Development

### Local Installation

```bash
git clone https://github.com/M-Scott-Lassiter/jest-geojson.git
cd jest-geojson
npm install
```

After installing, you should [run the build script](#building) to verify everything works without runtime errors before you start modifying.

### Project Structure

```
├── src
│   ├── core
|   │   └── <categories>
│   ├── matchers
|   │   └── <categories>
│   ├── setup
|   ├── core.js
|   ├── matchers.js
|   └── typedefinitions.js
├── tests
|   ├── <categories>
│   ├── core.test.js
|   └── matchers.test.js
```

-   `src`: contains all distribution files
    -   `core`: contains the key functionality used throughout
    -   `matchers`: contains the matchers powered by the core functions
    -   `setup`: contains the scripts that install the matchers into the Jest runtime
    -   `core.js` and `matchers.js`: export a single object containing their categories as object members, each with their respective functions
    -   `typedefinitions.js`: documents the project's JSDoc type definitions and contains no actual code
    -   `index.d.ts`: Typescript definitions for the matchers
-   `tests`: the Jest scripts used to verify the matchers work as designed

`package.json` contains entry points for `core.js`, `matchers.js`, and each of the loading scripts in `setup`.

### Building

Before submitting changes, run the build script locally, then commit:

```bash
npm run build # lint, test, document, and format everything automatically
```

### Linting and Formatting

Prettier provides formatting, and ESLint does linting using the Airbnb style guide. To lint, run the following:

```bash
npm run lint  # Runs ESLint

npm run format  # Runs Prettier
```

### Running Tests

This project provides high working confidence to developers by uses Jest itself for unit testing. Test locally using one of the following scripts:

```bash
npm run test # Runs all tests and generates coverage report

npm run test:<type> #runs the tests only in that category

npm run watch # Runs tests in watch mode
```

This requires at least Jest v24.0.0 (specified as a peer dependency) due to the use of `setupFilesAfterEnv`.

### Documentation

API Documentation is automatically generated from [JSDoc comments](https://jsdoc.app/) within the scripts. To generate, run:

```bash
npm run docs
```

The table of contents in this guide and the main README are automatically generated using the [`markdown-toc`](https://github.com/jonschlinkert/markdown-toc) package. To generate, run:

```bash
npm run tableofcontents
```

## Adding New Matchers

### Checklist

Before pushing to Github and opening a pull request:

-   [ ] Open an issue with detailed description of the purpose and required behavior
-   <u>Create Core Function (If Applicable)</u>
    -   [ ] Create a core function under `src/core/<category>`
    -   [ ] Register the core function in `src/core.js`
    -   [ ] Add a verification test to `tests/core.test.js`
    -   [ ] Document the function using JSDoc. Refer to the issue. Include good and bad examples.
-   <u>Create Matcher Function</u>
    -   [ ] Create a matcher function under `src/matchers/<category>`
    -   [ ] Register the matcher in `src/matchers.js`
    -   [ ] Add a verification test to `tests/matchers.test.js`
    -   [ ] Add the matcher to `src/index.d.ts`
    -   [ ] Add the matcher to the `.cz-config.js` list (alphabetical order under the `allMatchers` variable)
    -   [ ] Document the matcher using JSDoc. Refer to the issue. Include good and bad examples.
-   [ ] Create a test for the matcher under `tests/<category>`
-   [ ] Verify all tests pass and have 100% coverage
-   [ ] Add the matcher to the README.md list (alphabetical order within category)
-   [ ] Run the `build` script locally

### Creating Core Functions

All matcher functionality should have a core function that goes along with it. This goes under the `src/core/<category>` folder.

The corresponding matcher goes under `src/matchers/<category>`.

### Creating New Tests

Tests [reside separately](https://github.com/M-Scott-Lassiter/jest-geojson/tree/main/tests) from the source code and do not get distributed with the NPM package.

Provide 100% test coverage when creating new matchers. Use the opened issue to fully describe and document the logic on how this matcher works. This provides a persistent reference point for the logic that drives the tests.

The [Jest configuration file](https://github.com/M-Scott-Lassiter/jest-geojson/blob/main/jest.config.js) calls [a setup script](https://github.com/M-Scott-Lassiter/jest-geojson/blob/main/src/setup/all.js) before the test suite runs that extends Jest's built in matchers with all of the `Jest-GeoJSON` matchers. This is consistent with how it will get used by other developers in their own projects.

For consistency, organize your tests under the following three `describe` blocks:

-   Valid Use Cases
-   Invalid Use Cases
-   Error Snapshot Testing

Refer to any of the [test files](https://github.com/M-Scott-Lassiter/jest-geojson/tree/main/tests) for an example.

### Error Snapshot Testing

To ensure code refactoring doesn't result in [vague error messages](https://github.com/M-Scott-Lassiter/jest-geojson/issues/32), ensure there is at least one snapshot covering each expected error message.

Additionally, because matchers return the message as an arrow function, Jest doesn't actually execute these when running which prevents getting code coverage to 100% by normal methods.

To make sure these messages work correctly, you need to use Jest's [`toThrowErrorMatchingSnapshot`](https://jestjs.io/docs/expect#tothrowerrormatchingsnapshothint) matcher. Put these in their own describe block. For example:

```javascript
describe('Error Snapshot Testing', () => {
    test('Valid use case passes', () => {
        expect(() => expect([0, 0]).not.isValid2DCoordinate()).toThrowErrorMatchingSnapshot()
    })

    test('Invalid input to matcher', () => {
        expect(() => expect(false).isValid2DCoordinate()).toThrowErrorMatchingSnapshot()
    })
})
```

### Updating Error Snapshots

If you change the error messages, the snapshots will also change. Once you manually verify it still works as intended, update the snapshot using one of the following:

```bash
npm run test -- -u
npm run test:<type> -- -u
```

### Export Both Core and Matcher Functions

The files `src/core.js` and `src/matchers.js` each export their respective functions within an object for each category. Add any new matcher or function in alphabetical order under the appropriate category.

Ensure `tests/core.test.js` and `tests/matchers.test.js` each have a test that verifies the function and matcher successfully export.
