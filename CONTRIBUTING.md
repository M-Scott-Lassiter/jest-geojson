# Contributing Guide

<div align="center">

[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
[![Linting: ESLint](https://img.shields.io/badge/eslint-4B32C3?logo=eslint&logoColor=white)](https://github.com/eslint/eslint)
[![Code format: Prettier](https://img.shields.io/badge/prettier-F7B93E.svg?style=flat-square&logo=prettier&logoColor=black)](https://github.com/prettier/prettier)
[![Style Guide: Airbnb](https://img.shields.io/badge/code_style-airbnb-FF5A5F?logo=airbnb&logoColor=FF5A5F)](https://github.com/airbnb/javascript)
[![jest](https://jestjs.io/img/jest-badge.svg)](https://github.com/facebook/jest)
[![semantic-release: angular](https://img.shields.io/badge/semantic--release-angular-e10079?logo=semantic-release)](https://github.com/semantic-release/semantic-release)

</div>

**Thank you for contributing to `jest-geojson`!**

Before contributing, please take a moment to read through this document. This guide documents the standards, tooling, and processes that go into the CI/CD pipeline.

<details open="open">
    <summary><b>Table of Contents</b></summary>

<!-- Note: The toc tags mark autogenerated content. Do not manually modify the content here -->

<!-- toc -->

-   [Code of Conduct](#code-of-conduct)
-   [How can I Contribute?](#how-can-i-contribute)
    -   [Submit Issues](#submit-issues)
    -   [Propose New Matchers](#propose-new-matchers)
    -   [Submit a Pull Request](#submit-a-pull-request)
-   [New Matcher Submission Checklist](#new-matcher-submission-checklist)
-   [Commits](#commits)
-   [Development](#development)
    -   [Local Installation](#local-installation)
    -   [Project Structure](#project-structure)
    -   [Building](#building)
    -   [Linting and Formatting](#linting-and-formatting)
    -   [Running Tests](#running-tests)
    -   [Documentation](#documentation)
-   [Adding New Matchers](#adding-new-matchers)
    -   [Creating Core Functions](#creating-core-functions)
    -   [Creating New Tests](#creating-new-tests)
    -   [Error Snapshot Testing](#error-snapshot-testing)
    -   [Updating Error Snapshots](#updating-error-snapshots)
    -   [Export Both Core and Matcher Functions](#export-both-core-and-matcher-functions)

<!-- tocstop -->

</details>

## Code of Conduct

Please help keep this project open and inclusive. Refer to the [Code of Conduct](CODE_OF_CONDUCT.md) before your first contribution.

## How can I Contribute?

### Submit Issues

**Bug Reports**: Be as detailed as possible, and fill out all information requested in the [bug report template](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose).

_For security related issues, see the [security policy](https://github.com/M-Scott-Lassiter/jest-geojson/security/policy)._

**Documentation Requests**: Is something unclear in the documentation or the API? Submit a [documentation change request](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose)! Be as detailed as possible. If you have the question, chances are someone else will also who isn't as willing to speak up as you are. If you want to do it yourself, see the [documentation guidelines](#documentation) for instructions.

### Propose New Matchers

These are welcome! Before submitting:

-   Take a moment to make sure your matcher idea fits within the scope and aims of this project. Remember, `jest-geojson` exports ONLY matchers for Jest to aide test driven developers, not generic GeoJSON functions. For that, refer to [Turf.js](https://github.com/Turfjs/turf).
-   Search the issues for [new matchers](https://github.com/M-Scott-Lassiter/jest-geojson/issues?q=label%3A%22new+matcher%22+) to make sure this isn't already in the works.
-   Be as detailed as possible, and fill out a [new matcher request](https://github.com/M-Scott-Lassiter/jest-geojson/issues/new/choose). It is up to you to make your case of why the matcher should get included.

**Please ask** before embarking on any significant undertaking (e.g. implementing a new matcher, major code refactoring), otherwise you risk wasting time on something that might not fit well with the project. Do this by opening an issue for the proposal.

### Submit a Pull Request

Good pull requests are outstanding help. They should remain focused in scope and avoid unrelated commits.

To submit a pull request,

1. Fork and clone the repository
1. Create a branch for your edits
1. Make sure your work follows the [commits](#commits) guidance

## New Matcher Submission Checklist

-   [ ] Open an issue with detailed description of the purpose and required behavior
-   <u>Create Core Function</u>
    -   [ ] Create a core function under `src/core/<category>`
    -   [ ] Document the function using JSDoc. Refer to the issue.
    -   [ ] Register the core function in `src/core.js`
-   <u>Create Matcher Function</u>
    -   [ ] Create a matcher function under `src/matchers/<category>`
    -   [ ] Document the matcher using JSDoc. Refer to the issue.
    -   [ ] Register the matcher in `src/matchers.js`
-   <u>Add Testing</u>
    -   [ ] Create a test for the matcher under `tests/<category>`
    -   [ ] Add a test to `tests/core.test.js`
    -   [ ] Add a test to `matchers.test.js`
    -   [ ] Verify all tests pass and have 100% coverage
-   <u>Setup</u>
    -   [ ] Register the matcher under `src/setup/all.js`
    -   [ ] Register the matcher under `src/setup/<category>.js`
-   [ ] Add the matcher to the README.md list (alphabetical order within category)
-   [ ] Run the `build` script locally
-   [ ] Push to Github then open pull request

## Commits

All commits must follow the common commit guidance in [@m-scott-lassiter/semantic-release-github-npm-config](https://github.com/M-Scott-Lassiter/semantic-release-github-npm-config#commits).

This project uses [Commitizen](http://commitizen.github.io/cz-cli/) and [Husky](https://github.com/typicode/husky) hooks to help enforce good commit practices. Work on matcher functions must use that matcher function name as the scope.

When adding a new matcher, you must update this project's [Commitizen configuration](.cz-config.js) so the matcher shows up in the scope list.

## Development

### Local Installation

```bash
git clone https://github.com/M-Scott-Lassiter/jest-geojson.git
cd jest-geojson
npm install
```

### Project Structure

All distribution files are contained in the `src` folder. The `tests` folder contains the scripts used to verify the matchers work as designed (using the matchers themselves!).

`core` contains the functions that `matchers` use.

```
├── src
│   ├── core
│   │   ├── boundingBoxes
│   │   ├── coordinates
│   │   ├── features
│   │   ├── featureCollections
│   │   ├── functional
│   │   ├── geometries
│   │   └── geometryCollections
│   ├── matchers
│   │   ├── boundingBoxes
│   │   ├── coordinates
│   │   ├── features
│   │   ├── featureCollections
│   │   ├── functional
│   │   ├── geometries
│   │   └── geometryCollections
│   ├── setup
│   │   ├── all.js
│   │   ├── boundingBoxes.js
│   │   └── coordinates.js
|   ├── index.js
|   └── JestSetup.js
├── tests
│   │   ├── boundingBox
│   │   ├── coordinate
│   │   ├── feature
│   │   ├── featureCollection
│   │   ├── functional
│   │   ├── geometry
│   │   └── geometryCollection
```

The `index.js` serves two functions:

-   Document the project's JSDoc type definitions
-   Export each matcher function individually

When adding a new matcher, refer to the comments at the top of `index.js` for instructions.

### Building

After installing, run
Before submitting changes, run the build script locally, then commit:

```bash
npm run build
```

This will lint, test, document, and format everything automatically.

You should run this script after installing to verify you do not encounter run time errors before you get started.

### Linting and Formatting

Prettier provides formatting, and ESLint does linting using the Airbnb style guide. To lint, run the following:

```bash
npm run lint  # Runs ESLint

npm run format  # Runs Prettier
```

### Running Tests

This project provides high working confidence to developers by uses Jest itself for unit testing. Test locally using one of the following scripts:

```bash
npm run test # Runs all tests and generates coverage report

npm run test:dev # Runs tests in watch mode
```

### Documentation

API Documentation is automatically generated from [JSDoc comments](https://jsdoc.app/) within the scripts. To generate, run:

```bash
npm run docs
```

The table of contents in this guide and the main README are automatically generated using the [`markdown-toc`](https://github.com/jonschlinkert/markdown-toc) package. To generate, run:

```bash
npm run tableofcontents
```

## Adding New Matchers

### Creating Core Functions

All matcher functionality should have a core function that goes along with it. This goes under the `src/core/<category>` folder.

The corresponding matcher goes under `src/matchers/<category>`.

### Creating New Tests

Tests [reside separately](https://github.com/M-Scott-Lassiter/jest-geojson/tree/main/src) from the source code.

Provide 100% test coverage when creating new matchers. Use the opened issue to fully describe and document the logic on how this matcher works. This provides a persistent reference point for the logic that drives the tests.

The [Jest configuration file](https://github.com/M-Scott-Lassiter/jest-geojson/blob/main/jest.config.js) calls [a setup script](https://github.com/M-Scott-Lassiter/jest-geojson/blob/main/src/setup/all.js) before the test suite runs that extends Jest's built in matchers with all of the `jest-geojson` matchers. This is consistent with how it will get used by other developers in their own projects.

For consistency, organize your tests under the following three `describe` blocks:

-   Valid Use Cases
-   Invalid Use Cases
-   Error Snapshot Testing

Refer to any of the [test files](https://github.com/M-Scott-Lassiter/jest-geojson/tree/main/tests) for an example.

### Error Snapshot Testing

Because matchers return the message as an arrow function, Jest doesn't actually execute these when running which prevents getting code coverage to 100% by normal methods.

To make sure these messages work correctly, you need to use Jest's [`toThrowErrorMatchingSnapshot`](https://jestjs.io/docs/expect#tothrowerrormatchingsnapshothint) matcher. Put these in their own describe block.

```javascript
describe('Error Snapshot Testing', () => {
    test('.not.isValid2DCoordinate', () => {
        expect(() => expect([0, 0]).not.isValid2DCoordinate()).toThrowErrorMatchingSnapshot()
    })

    test('.isValid2DCoordinate', () => {
        expect(() => expect(false).isValid2DCoordinate()).toThrowErrorMatchingSnapshot()
    })
})
```

### Updating Error Snapshots

If you change the error messages, the snapshots will also change. Once you manually verify it still works as intended, update the snapshot:

```bash
npm run test -- -u
```

### Export Both Core and Matcher Functions

The files `src/core.js` and `src/matchers.js` each export their respective functions within an object for each category. Add any new matcher or function in alphabetical order under the appropriate category.

Ensure `tests/core.test.js` and `tests/matchers.test.js` each have a test that verifies the function and matcher successfully export.
